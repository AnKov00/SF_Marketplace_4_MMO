{% extends 'base.html' %}

{% block title %}{{ post.title }} - MMO Marketplace{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <a href="{% url 'post_list' %}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
    {% if user.is_authenticated and user != post.author %}
        <a href="{% url 'add_response' post.slug %}" class="btn btn-warning">üí¨ –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</a>
    {% endif %}
</div>

<!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—ä—è–≤–ª–µ–Ω–∏–∏ -->
<div class="mmo-card p-4 mb-4">
    <div class="row">
        <div class="col-md-8">
            <h1>{{ post.title }}</h1>
            <div class="d-flex gap-2 mb-3 flex-wrap">
                <span class="badge bg-danger">{{ post.category.name }}</span>
                <span class="badge {% if post.type_post == 'wts' %}bg-success{% else %}bg-info{% endif %}">
                    {% if post.type_post == 'wts' %}üí∞ –ü—Ä–æ–¥–∞–∂–∞{% else %}üõí –ü–æ–∫—É–ø–∫–∞{% endif %}
                </span>
                <span class="badge bg-warning text-dark">{{ post.price }} –∑–æ–ª–æ—Ç–∞</span>
                {% if not post.is_active %}
                    <span class="badge bg-secondary">–ù–µ–∞–∫—Ç–∏–≤–Ω–æ</span>
                {% endif %}
            </div>
            <p class="text-muted">üë§ –ê–≤—Ç–æ—Ä: {{ post.author.username }} | üìÖ {{ post.updated_at|date:"d.m.Y H:i" }}</p>
        </div>
    </div>

    <!-- –ì–∞–ª–µ—Ä–µ—è –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ -->
    {% if post.media.all %}
    <div class="row mb-4">
        <div class="col-12">
            <h4>üñºÔ∏è –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã ({{ post.media.count }})</h4>
            <div class="row">
                {% for media in post.media.all %}
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="media-item text-center">
                        {% if media.file %}
                            {% if media.file.name|lower|slice:"-4:" in '.jpg,.jpeg,.png,.gif,.webp,.bmp' %}
                                <img src="{{ media.file.url }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ {{ forloop.counter }}" 
                                     class="img-fluid rounded mb-2" 
                                     style="max-height: 300px; width: auto; object-fit: contain;">
                            {% else %}
                                <div class="bg-dark rounded p-3 text-center" style="min-height: 200px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                                    <span class="text-muted">üé• {{ media.filename }}</span>
                                    <a href="{{ media.file.url }}" class="text-warning mt-2" download>üì• –°–∫–∞—á–∞—Ç—å</a>
                                </div>
                            {% endif %}
                        {% else %}
                            <div class="bg-dark rounded p-3 text-center" style="min-height: 200px; display: flex; align-items: center; justify-content: center;">
                                <span class="text-muted">üìÑ –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω</span>
                            </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% else %}
    <div class="alert alert-info">
        üì≠ –ö —ç—Ç–æ–º—É –æ–±—ä—è–≤–ª–µ–Ω–∏—é –Ω–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω—ã –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã
    </div>
    {% endif %}

    <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
    <div class="mb-4">
        <h4>üìñ –û–ø–∏—Å–∞–Ω–∏–µ</h4>
        <div class="post-content bg-dark p-3 rounded">
            {{ post.content|linebreaks }}
        </div>
    </div>
</div>

<!-- –û—Ç–∑—ã–≤—ã -->
<div class="mmo-card p-4">
    <h3>üí¨ –û—Ç–∑—ã–≤—ã ({{ responses.count }})</h3>
    
    {% if responses %}
        {% for response in responses %}
        <div class="response-card p-3 mb-3 rounded">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <strong class="text-warning">üë§ {{ response.author.username }}</strong>
                    <span class="badge bg-success ms-2">‚úì –ü—Ä–∏–Ω—è—Ç</span>
                </div>
                <small class="text-muted">{{ response.created_at|date:"d.m.Y H:i" }}</small>
            </div>
            <p class="mb-0 mt-2">{{ response.content }}</p>
        </div>
        {% endfor %}
    {% else %}
        <div class="text-center py-4">
            <p class="text-muted">üì≠ –ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤ –Ω–∞ —ç—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ.</p>
            {% if user.is_authenticated and user != post.author %}
                <p>–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –æ—Å—Ç–∞–≤–∏—Ç –æ—Ç–∑—ã–≤!</p>
            {% endif %}
        </div>
    {% endif %}
</div>

<style>
.mmo-card {
    background: rgba(30, 55, 153, 0.8);
    border: 2px solid #4a69bd;
    border-radius: 10px;
}
.response-card {
    background: rgba(74, 105, 189, 0.6);
    border: 1px solid #4a69bd;
}
.post-content {
    background: rgba(0, 0, 0, 0.3) !important;
    border-left: 3px solid #f6b93b;
}
.media-item img {
    transition: transform 0.3s ease;
}
.media-item img:hover {
    transform: scale(1.05);
}
</style>
{% endblock %}